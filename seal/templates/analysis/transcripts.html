{% extends 'base.html' %}

{% block static %}
	{% include 'includes/loading_bar.dt.j2' %}
{% endblock %}

{% block content %}
	{% include 'includes/sidebar.j2' %}
	<div class="w3-main w3-padding" style="margin-left:350px">
		<table id="genes" class="w3-table-all w3-hoverable" style="width:100%">
			<thead>
				<tr>
                    <th class="w3-flat-green-sea">feature</th>
                    <th class="w3-flat-green-sea">biotype</th>
                    <th class="w3-flat-green-sea">feature_type</th>
                    <th class="w3-flat-green-sea">symbol</th>
                    <th class="w3-flat-green-sea">symbol_source</th>
                    <th class="w3-flat-green-sea">gene</th>
                    <th class="w3-flat-green-sea">source</th>
                    <th class="w3-flat-green-sea">protein</th>
                    <th class="w3-flat-green-sea">canonical</th>
                    <th class="w3-flat-green-sea">hgnc</th>
                    <th class="w3-flat-green-sea">ref</th>
				</tr>
			</thead>
			<tfoot>
				<tr>
                    <th class="w3-flat-green-sea">feature</th>
                    <th class="w3-flat-green-sea">biotype</th>
                    <th class="w3-flat-green-sea">feature_type</th>
                    <th class="w3-flat-green-sea">symbol</th>
                    <th class="w3-flat-green-sea">symbol_source</th>
                    <th class="w3-flat-green-sea">gene</th>
                    <th class="w3-flat-green-sea">source</th>
                    <th class="w3-flat-green-sea">protein</th>
                    <th class="w3-flat-green-sea">canonical</th>
                    <th class="w3-flat-green-sea">hgnc</th>
                    <th class="w3-flat-green-sea">ref</th>
				</tr>
			</tfoot>
		</table>
	</div>
{% endblock %}

{% block script %}
<script type="text/javascript">
	$(document).ready(function() {
	    table = $('#genes').DataTable({
			"language": {
				"loadingRecords": '<div class="animation-bar-1"><span style="width:100%"></span></div>',
			},
			scrollX: true,
			"proccessing": true,  "serverSide": true,
    		ajax: {
				url: '/json/transcripts',
				type: 'POST',
				headers: {
	                'X-CSRF-TOKEN': '{{ csrf_token() }}'
                },
			},
            colReorder: true,
	        fixedColumns: {
				left:1,
				right:1
			},
    		"columns": [
                { 'className': 'showTitle control-size-200', 'data': 'feature'},
                { 'className': 'showTitle control-size-300', 'data': 'biotype'},
                { 'className': 'showTitle control-size-200', 'data': 'feature_type'},
                { 'className': 'showTitle control-size-150', 'data': 'symbol'},
                { 'className': 'showTitle control-size-150', 'data': 'symbol_source'},
                { 'className': 'showTitle control-size-100', 'data': 'gene'},
                { 'className': 'showTitle control-size-100', 'data': 'source'},
                { 'className': 'showTitle control-size-200', 'data': 'protein'},
                { 'className': 'showTitle control-size-100', 'data': 'canonical'},
                { 'className': 'showTitle control-size-100', 'data': 'hgnc'},
				{
					"className": 'showTitle size-25 w3-center',
					"orderable":      false,
					"data": {
						"_": "val",
						"display" : function ( data, type, row, meta ) {
                            if (data) {
    							const transcript=data["feature"];
    							if (data["val"]) {
    								return '<input id="'+ transcript +'" class="w3-check" type="checkbox" checked="checked" onclick="add_transcript(\''+ transcript +'\');">';
    							} else {
    								return '<input id="'+ transcript +'" class="w3-check" type="checkbox" onclick="add_transcript(\''+ transcript +'\');">';
    							}
                            }
                            return "NA"
					    }
					}
				}
			],
			"columnDefs": [
	            {
	                "render": {
						"display": function ( data, type, row ) {
							if (data) {
								response = '<i title="CANONICAL" class="w3-text-flat-peter-river fas fa-star"></i>';
							} else {
								response = '<i title="" class="w3-text-flat-peter-river far fa-star"></i>';
							}
							return response;
		                },
						"sort": function ( data, type, row ) {
							return data;
		                },
					},
	                "targets": 8
	            }
			],
		});
	});

	// Script to open and close sidebar
	function w3_open() {
		document.getElementById("sidebar").style.display = "block";
		document.getElementById("overlay").style.display = "block";
	}

	function w3_close() {
		document.getElementById("sidebar").style.display = "none";
		document.getElementById("overlay").style.display = "none";
	}

    function add_transcript(transcript) {
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token() }}");
                }
            }
        });
        $.ajax({
            type: "POST",
            url: "/add/preferred",
            data: {
                "transcript": transcript
            }
        })
    }
</script>
{% endblock %}
