{% extends 'base.html' %}

{% block static %}
<link rel="stylesheet" href="https://cdn.datatables.net/searchbuilder/1.1.0/css/searchBuilder.dataTables.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.7.1/css/buttons.dataTables.min.css" />
<script src="https://cdn.datatables.net/searchbuilder/1.1.0/js/dataTables.searchBuilder.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js"></script>

<style>

	.tableFixHead {
	    overflow-y: auto;
	    height: 300px;
	}
	.tableFixHead thead th {
	    position: sticky;
	    top: 0;
	}
	/*
	Â©Raj Rajhans
	rajrajhans.com
	Day #4 : 30 Days CSS
	*/

	.animation-bar-1 span {
	    position: relative;
	    display: inline-block;
	    vertical-align: middle;
	    height: 20px;
	    border-radius: 10px;
	    overflow: hidden;
	    background-size: 100%;
	    background: #f56982 linear-gradient(to bottom, #3498db, #2980b9);
	    animation: progress-anim-1 5s infinite linear;
	}

	.animation-bar-1 span:after {
	    position: absolute;
	    top: 0;
	    left: 0;
	    right: 0;
	    bottom: 0;
	    content: "";
	    background-image: linear-gradient(45deg, #ffffff 25%,
	                                        rgba(0, 0, 0, 0) 25%,
	                                        rgba(0, 0, 0, 0) 50%,
	                                        #ffffff 50%,
	                                        #ffffff 75%,
	                                        rgba(0, 0, 0, 0) 75%,
	                                        rgba(0, 0, 0, 0));

	    background-size: 30px 30px;
	    opacity: 0.3;
	    animation: progress-anim-1-after 0.5s infinite linear;
	}

	@-webkit-keyframes progress-anim-1-after {
	    0% {
	        background-position: 0 100%;
	    }
	    100% {
	        background-position: 30px 100%;
	    }
	}
</style>

{% endblock %}

{% block content %}
	{% include 'includes/sidebar.j2' %}
	<div class="w3-main" style="margin-left:350px">
		<div class="w3-bar w3-flat-silver w3-left-align w3-padding">
			<h3><i class="fas fa-user-tag"></i> <i>{{ sample.samplename }}</i></h3>
		</div>
		<div class="w3-padding">
			<div class="w3-row w3-padding">
				<select id="selectBox" class="w3-select w3-border w3-col m3 l2 s6" onchange="changeFilter(value);">
					{% for filter in filters %}
						<option value="{{ filter.id }}">{{filter.filtername}}</option>
					{% endfor %}
				</select>
				<!-- <button class="w3-button w3-flat-green-sea w3-hover-flat-turquoise w3-ripple" onclick="save_filters()">Save filters</button> -->
			</div>
			<div class="w3-padding">
				<table id="variants" class="w3-table-all" style="width:100%">
					<thead>
						<tr class="w3-flat-green-sea">
	                        <th class="w3-center control-size-25"></th>
							<th class='showTitle control-size-100'>Gene</th>
							<th class='showTitle control-size-100'>Feature</th>
							<th class='showTitle control-size-75'>Can.</th>
							<th class='showTitle control-size-150'>Exon/Intron</th>
							<th class='showTitle control-size-250'>HGVSg</th>
							<th class='showTitle control-size-250'>HGVSc</th>
							<th class='showTitle control-size-250'>HGVSp</th>
							<th class='showTitle control-size-100'>GnomAD</th>
							<th class='showTitle control-size-100'>SEAL (pct)</th>
							<th class='showTitle control-size-100'>SEAL (cnt)</th>
							<th class='showTitle control-size-100'>In Family</th>
							<th class='showTitle control-size-300'>ClinSig</th>
							<th class='showTitle control-size-100'>Impact</th>
							<th class='showTitle control-size-300'>Consequence</th>
							<th class='showTitle control-size-100'>MES ref</th>
							<th class='showTitle control-size-100'>MES diff</th>
							<th class='showTitle control-size-100'>MES alt</th>
							<th class='showTitle control-size-125'>SpliceAI DS</th>
							<th class='showTitle control-size-125'>SpliceAI DP</th>
							<th class='showTitle control-size-125'>SpliceAI Type</th>
							<th class='showTitle control-size-100'>Missense</th>
						</tr>
					</thead>
					<tfoot>
						<tr class="w3-flat-green-sea">
							<th class="w3-center control-size-25"></th>
							<th class='showTitle control-size-100'>
								Gene
								<span onclick="openHelpModal(title='Gene', content='The gene symbol (e.g. HGNC) (where available) to the output.', footer='For more information see : <a  href=\'https://www.genenames.org/\' target=\'_blank\' style=\'text-decoration:underline\'><i>HGNC</i></a>')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-100'>
								Feature
								<span onclick="openHelpModal(title='Feature', content='The feature ID, mainly, corresponding to the RefSeq transcript, or the ensembl ID.', footer='For more information see : <a  href=\'http://grch37.ensembl.org/info/docs/tools/vep/script/index.html\' target=\'_blank\' style=\'text-decoration:underline\'><i>VEP documentation</i></a>')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-75'>
								Can.
								<span onclick="openHelpModal(title='Canonical', content='Flag if the Feature corresponding to the canonical transcript.<br />Based on MobiDetails API database.', footer='For more information see : <a  href=\'https://mobidetails.iurc.montp.inserm.fr/MDAPI/\' target=\'_blank\' style=\'text-decoration:underline\'><i>MDAPI</i></a>')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-150'>
								Exon/Intron
								<span onclick="openHelpModal(title='Exon/Intron', content='The number of the exon or intron wich have the variant.', footer='')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
	                        <th class='showTitle control-size-250'>
								HGVSg
								<span onclick="openHelpModal(title='HGVSg', content='The HGVS genomic sequence name', footer='For more information see : <a  href=\'https://varnomen.hgvs.org/\' target=\'_blank\' style=\'text-decoration:underline\'><i>varnomen</i></a>')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
	                        <th class='showTitle control-size-250'>
								HGVSc
								<span onclick="openHelpModal(title='HGVSc', content='The HGVS coding sequence name', footer='For more information see : <a  href=\'https://varnomen.hgvs.org/\' target=\'_blank\' style=\'text-decoration:underline\'><i>varnomen</i></a>')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-250'>
								HGVSp
								<span onclick="openHelpModal(title='HGVSp', content='The HGVS protein sequence name', footer='For more information see : <a  href=\'https://varnomen.hgvs.org/\' target=\'_blank\' style=\'text-decoration:underline\'><i>varnomen</i></a>')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-100'>
								GnomAD
								<span onclick="openHelpModal(title='GnomAD', content='The Genome Aggregation Database (gnomAD) is a resource developed by an international coalition of investigators, with the goal of aggregating and harmonizing both exome and genome sequencing data from a wide variety of large-scale sequencing projects, and making summary data available for the wider scientific community.<br /> The dataset used is from release 2.1 (GRCh37/hg19) spans 125,748 exome sequences and 15,708 whole-genome sequences from unrelated individuals sequenced as part of various disease-specific and population genetic studies', footer='For more information see : <a  href=\'https://gnomad.broadinstitute.org\' target=\'_blank\' style=\'text-decoration:underline\'><i>GnomAD website</i></a>')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-100'>
								SEAL (pct)
								<span onclick="openHelpModal(title='SEAL (pct)', content='The percentage this variant appear in the SEAL database', footer='Warning : this value include this sample')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-100'>
								SEAL (cnt)
								<span onclick="openHelpModal(title='SEAL (count)', content='The number of occurences this variant appear in the SEAL database', footer='Warning : this value include this sample')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-100'>
								In Family
								<span onclick="openHelpModal(title='In Family', content='', footer='')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-300'>
								ClinSig
								<span onclick="openHelpModal(title='ClinSig', content='ClinVar clinical significance of the dbSNP variant.', footer='For more information see : <a  href=\'https://www.ncbi.nlm.nih.gov/clinvar/docs/clinsig/\' target=\'_blank\' style=\'text-decoration:underline\'><i>ClinSig documentation</i></a>')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-100'>
								Impact
								<span onclick="openHelpModal(title='Impact', content='IMPACT is calculated by VEP, based on consequences and compatibility with snpEff. <div class=\'w3-flash w3-warning\'><p>Impact categories must be used with care, they were created only to help and simplify the filtering process. Obviously, there is no way to predict whether a HIGH impact or a LOW impact variant is the one producing a phenotype of interest.</p></div>', footer='For more information see : <a  href=\'https://m.ensembl.org/info/genome/variation/prediction/predicted_data.html\' target=\'_blank\' style=\'text-decoration:underline\'><i>VEP documentation</i></a> & <a  href=\'https://pcingola.github.io/SnpEff/se_inputoutput/#impact-prediction\' target=\'_blank\' style=\'text-decoration:underline\'><i>snpEff documentation</i></a>')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-300'>
								Consequence
								<span onclick="openHelpModal(title='Consequence', content='Consequences are calculated by VEP following SO terms.', footer='For more information see : <a  href=\'https://m.ensembl.org/info/genome/variation/prediction/predicted_data.html\' target=\'_blank\' style=\'text-decoration:underline\'><i>VEP documentation</i></a>')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-100'>
								MES ref
								<span onclick="openHelpModal(title='MES ref', content='', footer='')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-100'>
								MES diff
								<span onclick="openHelpModal(title='MES diff', content='', footer='')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-100'>
								MES alt
								<span onclick="openHelpModal(title='MES alt', content='', footer='')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-125'>
								SpliceAI DS
								<span onclick="openHelpModal(title='SpliceAI DS', content='Delta score (DS) of a variant, defined as the maximum of ranges from 0 to 1 and can be interpreted as the probability of the variant being splice-altering. The author-suggested cutoffs are: <br /><ul><li>0.2 (high recall)</li><li>0.5 (recommended)</li><li>0.8 (high precision)</li></ul>', footer='For more information see : <a  href=\'https://github.com/Ensembl/VEP_plugins/blob/release/104/SpliceAI.pm\' target=\'_blank\' style=\'text-decoration:underline\'><i>VEP plugins spliceAI</i></a>')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-125'>
								SpliceAI DP
								<span onclick="openHelpModal(title='SpliceAI DP', content='Delta positions (DP)', footer='For more information see : <a  href=\'https://github.com/Ensembl/VEP_plugins/blob/release/104/SpliceAI.pm\' target=\'_blank\' style=\'text-decoration:underline\'><i>VEP plugins spliceAI</i></a>')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-125'>
								SpliceAI Type
								<span onclick="openHelpModal(title='SpliceAI Type', content='Acceptor gain (AG), acceptor loss (AL), donor gain (DG), and donor loss (DL).', footer='For more information see : <a  href=\'https://github.com/Ensembl/VEP_plugins/blob/release/104/SpliceAI.pm\' target=\'_blank\' style=\'text-decoration:underline\'><i>VEP plugins spliceAI</i></a>')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
							<th class='showTitle control-size-100'>
								Missense
								<span onclick="openHelpModal(title='Missense', content='Here we calculated the mean from 10 prediction scores. The scores have been selected as the top 10 prediction tools from the dbNSFP v4 publication.<br /><ul><li>CADD</li><li>VEST4</li><li>MetaSVM</li><li>MetaLR</li><li>Eigen</li><li>Eigen-PC</li><li>REVEL</li><li>BayesDel_addAF</li><li>BayesDel_noAF</li><li>ClinPred</li></ul>', footer='For more information see : <a  href=\'https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7709417/\' target=\'_blank\' style=\'text-decoration:underline\'><i>dbNSFP v4</i></a>')" class="w3-opacity-max w3-hover-opacity">
									<i class="fas fa-question-circle"></i>
								</span>
							</th>
						</tr>
					</tfoot>
				</table>
			</div>
		</div>
	</div>

	<!-- MODALS -->
	<div id="help-modal" class="w3-modal">
		<div class="w3-modal-content w3-card-4">
			<header class="w3-container w3-flat-turquoise">
				<span onclick="document.getElementById('help-modal').style.display='none'"
					class="w3-button w3-display-topright">&times;</span>
				<h5 id="help-modal-title"></h5>
			</header>
			<div class="w3-container">
				<p id="help-modal-content"></p>
			</div>
			<footer class="w3-container w3-flat-turquoise">
				<p id="help-modal-footer"></p>
			</footer>
		</div>
	</div>

	<div id="modal-details-variant" class="w3-modal">
		<div class="w3-modal-content w3-card-4 w3-animate-zoom">
			<header class="w3-container w3-flat-emerald">
				<span onclick="document.getElementById('modal-details-variant').style.display='none'"
				class="w3-button w3-flat-emerald w3-xlarge w3-display-topright">&times;</span>
				<h2>Variant : <span id="variant-id"><span></h2>
			</header>

			<div class="w3-bar w3-border-bottom">
				<button class="tablink w3-bar-item w3-button" onclick="openDetails(event, 'allFeatures')">All Features</button>
			</div>

			<div id="allFeatures" class="w3-container detail">
				<h1>All features</h1>
				<div id="allFeaturesTable"></div>
			</div>
			<div class="w3-container w3-light-grey w3-padding">
				<button class="w3-button w3-right w3-white w3-border"
				onclick="document.getElementById('modal-details-variant').style.display='none'">Close</button>
			</div>
		</div>
	</div>

{% endblock %}


{% block script %}

	const clinsig_dict = {
		"uncertain_significance": {
			"color": "orange",
			"score": 4
		},
		"conflicting_interpretations_of_pathogenicity": {
			"color": "orange",
			"score": 4
		},
		"pathogenic": {
			"color": "alizarin",
			"score": 10
		},
		"likely_pathogenic": {
			"color": "alizarin",
			"score": 7
		},
		"pathogenic/likely_pathogenic": {
			"color": "alizarin",
			"score": 6
		},
		"benign": {
			"color": "turquoise",
			"score": -1.5
		},
		"likely_benign": {
			"color": "turquoise",
			"score": -0.25
		},
		"benign/likely_benign": {
			"color": "turquoise",
			"score": -1
		},
		"not_provided": {
			"color": "peter-river",
			"score": -0.1
		},
		"_other": {
			"color": "peter-river",
			"score": 0
		},
		"protective": {
			"color": "peter-river",
			"score": -0.1
		},
		"association": {
			"color": "peter-river",
			"score": 0.1
		},
		"risk_factor": {
			"color": "peter-river",
			"score": 0.2
		},
		"affects": {
			"color": "peter-river",
			"score": 0.15
		}
	};

	const impact_dict = {
		"MODERATE": {
			"color": "orange",
			"score" : 2
		},
		"MODIFIER": {
			"color": "orange",
			"score" : 1.5
		},
		"HIGH": {
			"color": "alizarin",
			"score" : 3
		},
		"LOW": {
			"color": "turquoise",
			"score" : 1
		}
	};

	const consequences_dict = {
		"stop_gained": {
			"color": "ff0000",
			"score": 0,
		},
		"stop_lost": {
			"color": "ff0000",
			"score": 0,
		},
		"splice_acceptor_variant": {
			"color": "FF581A",
			"score": 0,
		},
		"splice_donor_variant": {
			"color": "FF581A",
			"score": 0,
		},
		"frameshift_variant": {
			"color": "9400D3",
			"score": 0,
		},
		"transcript_ablation": {
			"color": "ff0000",
			"score": 0,
		},
		"start_lost": {
			"color": "ffd700",
			"score": 0,
		},
		"transcript_amplification": {
			"color": "ff69b4",
			"score": 0,
		},
		"missense_variant": {
			"color": "ffd700",
			"score": 0,
		},
		"protein_altering_variant": {
			"color": "ff0080",
			"score": 0,
		},
		"splice_region_variant": {
			"color": "ff7f50",
			"score": 0,
		},
		"inframe_insertion": {
			"color": "ff69b4",
			"score": 0,
		},
		"inframe_deletion": {
			"color": "ff69b4",
			"score": 0,
		},
		"incomplete_terminal_codon_variant": {
			"color": "ff00ff",
			"score": 0,
		},
		"stop_retained_variant": {
			"color": "76ee00",
			"score": 0,
		},
		"start_retained_variant": {
			"color": "76ee00",
			"score": 0,
		},
		"synonymous_variant": {
			"color": "76ee00",
			"score": 0,
		},
		"coding_sequence_variant": {
			"color": "458b00",
			"score": 0,
		},
		"mature_miRNA_variant": {
			"color": "458b00",
			"score": 0,
		},
		"intron_variant": {
			"color": "02599c",
			"score": 0,
		},
		"NMD_transcript_variant": {
			"color": "ff4500",
			"score": 0,
		},
		"non_coding_transcript_exon_variant": {
			"color": "32cd32",
			"score": 0,
		},
		"non_coding_transcript_variant": {
			"color": "32cd32",
			"score": 0,
		},
		"3_prime_UTR_variant": {
			"color": "7ac5cd",
			"score": 0,
		},
		"5_prime_UTR_variant": {
			"color": "7ac5cd",
			"score": 0,
		},
		"upstream_gene_variant": {
			"color": "a2b5cd",
			"score": 0,
		},
		"downstream_gene_variant": {
			"color": "a2b5cd",
			"score": 0,
		},
		"TFBS_ablation": {
			"color": "a52a2a",
			"score": 0,
		},
		"TFBS_amplification": {
			"color": "a52a2a",
			"score": 0,
		},
		"TF_binding_site_variant": {
			"color": "a52a2a",
			"score": 0,
		},
		"regulatory_region_ablation": {
			"color": "a52a2a",
			"score": 0,
		},
		"regulatory_region_amplification": {
			"color": "a52a2a",
			"score": 0,
		},
		"regulatory_region_variant": {
			"color": "a52a2a",
			"score": 0,
		},
		"feature_elongation": {
			"color": "7f7f7f",
			"score": 0,
		},
		"feature_truncation": {
			"color": "7f7f7f",
			"score": 0,
		},
		"intergenic_variant": {
			"color": "636363",
			"score": 0,
		}
	};

	const spliceAI_Type_dict = {
		"AG": {
			"color": "w3-flat-amethyst"
		},
		"AL": {
			"color": "w3-flat-wisteria"
		},
		"DG": {
			"color": "w3-flat-carrot"
		},
		"DL": {
			"color": "w3-flat-pumpkin"
		}
	};

	$(document).ready(function() {
	    table = $('#variants').DataTable({
			buttons:[{
				extend: 'searchBuilder',
	        }],
			"language": {
				"loadingRecords": '<div class="animation-bar-1"><span style="width:100%"></span></div>',
			},
			dom: 'Blfrtip',
			scrollX: true,
    		ajax: '/json/variants/sample/{{ sample.id }}',
    		"columns": [
		        {
		            "className":      'details-control',
		            "orderable":      false,
		            "data":           "id",
	                "render": {
						"_": function ( data, type, row ) {
							return data;
						},
						"display": function ( data, type, row ) {
							response = '<i onclick="openDetailsVariantModal(\'' + data + '\')" class="w3-text-flat-peter-river w3-hover-text-flat-concrete fas fa-plus-circle" style="cursor: pointer;"></i></button>'
							return response;
		                },
					},
		        },
				{ "className": 'showTitle control-size-100', "data": "annotations.SYMBOL"},
				{ "className": 'showTitle control-size-100', "data": "annotations.Feature"},
				{
					"className": 'showTitle w3-center control-size-75',
					"data": "annotations.canonical",
	                "render": {
						"_": function ( data, type, row ) {
							return data;
						},
						"display": function ( data, type, row ) {
							if (data) {
								response = '<i title="CANONICAL" class="w3-text-flat-peter-river fas fa-star"></i>';
							} else {
								response = '<i title="" class="w3-text-flat-peter-river far fa-star"></i>';
							}
							return response;
		                },
					},
				},
				{
					"className": 'showTitle control-size-150',
					"data": "annotations.EI",
					"render": {
						"_": function ( data, type, row ) {
							return data;
						},
						"sort": function ( data, type, row ) {
							if (data == null) {
								return "NA";
							}
							pos_split = data.split(/\s|\//);
							if(pos_split[0] == "Exon") {
								myvar = Number(pos_split[1]).toString().padStart(4, "0") + "_" + Number(pos_split[2]).toString().padStart(4, "0") + "_0";
							} else if (pos_split[0] == "Intron") {
								myvar = Number(pos_split[1]).toString().padStart(4, "0") + "_" + Number(pos_split[2]).toString().padStart(4, "0") + "_1";
							} else {
								myvar = "NA"
							}
							return myvar
						},
					}
				},
				{ "className": 'showTitle control-size-250', "data": "annotations.HGVSg"},
				{ "className": 'showTitle control-size-250', "data": "annotations.HGVSc"},
				{ "className": 'showTitle control-size-250', "data": "annotations.HGVSp"},
				{
					"className": 'showTitle control-size-100',
					"data": "annotations.GnomADg_max",
					"render" : {
						"_" : function ( data, type, row, meta ) {
							if(data != null) {
					    		return data.toFixed(6);
							} else {
								return null;
							}
					    },
						"display" : function ( data, type, row, meta ) {
							if(data != null) {
					    		return data.toFixed(6);
							} else {
								return "NA";
							}
					    },
	            		"sort" : function ( data, type, row, meta ) {
							if(data != null) {
					    		return data.toFixed(6);
							} else {
								num = -1
								return num.toFixed(6);
							}
					    }
					},
				},
				{
					"className": 'showTitle control-size-125',
					"data": "inseal",
					"render" : {
						"_" : function ( data, type, row, meta ) {
							percent = (data["occurrences"]/data["total_samples"]).toFixed(4);
							return percent;
					    },
					},
				},
				{
					"className": 'showTitle control-size-125',
					"data": "inseal",
					"render" : {
						"_" : function ( data, type, row, meta ) {
							return data["occurrences"];
					    },
						"sort" : function ( data, type, row, meta ) {
							return data["occurrences"];
					    }
					},
				},
				{
					"className": 'showTitle size-125',
					"data": "inseal",
					"render" : {
						"_" : function ( data, type, row, meta ) {
							members = null
							if (data["members"].length > 0) {
								members = " (" + data["members"].join(", ") + ")"
							}
							return data["occurences_family"] + members;
					    },
						"sort" : function ( data, type, row, meta ) {
							return data["occurences_family"];
					    }
					},
				},
				{
					"className": 'showTitle size-300',
					"data": "annotations.CLIN_SIG",
					"render": {
						"_": function ( data, type, row, meta ) {
							cell = {
								"orange": "",
								"alizarin": "",
								"turquoise": "",
								"peter-river": "",
								"asbestos": ""
							}
							style = "style='max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;'";

							for (idx in data) {
								color = data[idx] in clinsig_dict ? clinsig_dict[data[idx]]["color"] : "asbestos"
								cell[color] += " <span class='w3-tag w3-flat-" + color + "' " + style + ">" + data[idx] + "</span>"
							}
							return cell["orange"] + cell["alizarin"] + cell["turquoise"] + cell["peter-river"] + cell["asbestos"];
					    },
						"filter": function ( data, type, row, meta ) {
							return data.toString();
					    },
						"sort": function ( data, type, row, meta ) {
							score = 0;
							for (idx in data) {
								score += data[idx] in clinsig_dict ? clinsig_dict[data[idx]]["score"] : 0
							}
							return score;
					    },
					}
				},
				{
					"className": 'showTitle size-100',
					"data": "annotations.IMPACT",
					"render": {
						"_": function ( data, type, row, meta ) {
							style = "style='max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;'";
							cell = "<span class='w3-tag w3-flat-" + impact_dict[data]["color"] + "' " + style + ">" + data + "</span>";
							return cell;
					    },
						"filter": function ( data, type, row, meta ) {
							return data.toString();
					    },
						"sort": function ( data, type, row, meta ) {
							return impact_dict[data]["score"];
					    },
					}

				},
				{
					"className": 'showTitle size-300',
					"data": "annotations.Consequence",
					"render": {
						"_": function ( data, type, row, meta ) {
							cell = "";
							for (idx in consequences_dict) {
								if (data.includes(idx)){
									color = idx in consequences_dict ? consequences_dict[idx]["color"] : "7f8c8d";
									style = "style='max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;background-color:#" + color + ";'";
									cell += " <span class='w3-tag' " + style + ">" + idx + "</span>"
								}
							}
							return cell;
					    },
						"filter": function ( data, type, row, meta ) {
							return data.toString();
					    },
						"sort": function ( data, type, row, meta ) {
							sort = "A";
							for (idx in consequences_dict) {
								sort += data.includes(idx) ? "1" : "0";
							}
							return sort;
					    }
					},
				},
				{
					"className": 'showTitle size-100',
					"data": "annotations.MaxEntScan_ref",
					"render": {
						"_": function ( data, type, row, meta ) {
							if (data == null){
								return -999;
							}
							return parseFloat(data).toFixed(3);
					    },
						"display": function ( data, type, row, meta ) {
							if (data == null){
								return "NA";
							}
							return parseFloat(data).toFixed(3);
					    },
					},
				},
				{
					"className": 'showTitle size-100',
					"data": "annotations.MaxEntScan_diff",
					"render": {
						"_": function ( data, type, row, meta ) {
							if (data == null){
								return -999;
							}
							return parseFloat(data).toFixed(3);
					    },
						"display": function ( data, type, row, meta ) {
							if (data == null){
								return "NA";
							}
							return parseFloat(data).toFixed(3);
					    },
					},
				},
				{
					"className": 'showTitle size-100',
					"data": "annotations.MaxEntScan_alt",
					"render": {
						"_": function ( data, type, row, meta ) {
							if (data == null){
								return -999;
							}
							return parseFloat(data).toFixed(3);
					    },
						"display": function ( data, type, row, meta ) {
							if (data == null){
								return "NA";
							}
							return parseFloat(data).toFixed(3);
					    },
					},
				},
				{
					"className": 'showTitle size-125',
					"data": "annotations.maxSpliceAI_DS",
					"render": {
						"_": function ( data, type, row, meta ) {
							if (data == null){
								return null;
							}
							return parseFloat(data).toFixed(3);
					    },
						"display": function ( data, type, row, meta ) {
							if (data == null){
								return "NA";
							}
							value = parseFloat(data).toFixed(3)
							classw3css = "w3-text-black";
							if (value >= 0.8) {
								classw3css = "w3-text-flat-orange";
							}
							if (value >= 0.5) {
								classw3css = "w3-text-flat-alizarin";
							}
							return "<span class='" + classw3css + "'>" + value + "</span>";
					    },
					},
				},
				{
					"className": 'w3-center showTitle size-125',
					"data": "annotations.maxSpliceAI_DP",
					"render": {
						"_": function ( data, type, row, meta ) {
							return data;
					    },
						"display": function ( data, type, row, meta ) {
							if (data == null){
								return "NA";
							}
							return data;
					    },
					},
				},
				{
					"className": 'w3-center showTitle size-125',
					"data": "annotations.maxSpliceAI_type",
					"render": {
						"_": function ( data, type, row, meta ) {
							return data;
					    },
						"display": function ( data, type, row, meta ) {
							color = data in spliceAI_Type_dict ? spliceAI_Type_dict[data]["color"] : "w3-flat-asbestos";
							data = data == null ? "NA" : data;
							return "<span class='w3-tag " + color + "'>" + data + "</span>";
					    },
					},
				},
				{
					"className": 'showTitle size-100',
					"data": "annotations.missenseMean",
					"render": {
						"_" : function ( data, type, row, meta ) {
							if(data != null) {
					    		return data.toFixed(4);
							} else {
								return null;
							}
					    },
						"display" : function ( data, type, row, meta ) {
							if(data != null) {
					    		return data.toFixed(4);
							} else {
								return "NA";
							}
					    },
	            		"sort" : function ( data, type, row, meta ) {
							if(data != null) {
					    		return data.toFixed(4);
							} else {
								num = -1
								return num.toFixed(4);
							}
					    }
					},
				},
			]
		});

	      // Event listener to the two range filtering inputs to redraw on input
	      $('#gnomadMax').keyup( function() {
	          table.draw();
	      } );



	} );

	function save_filters() {
		var d = table.searchBuilder.getDetails();
		console.log(JSON.stringify(d));
	}
	// Script to open and close sidebar
	function w3_open() {
		document.getElementById("sidebar").style.display = "block";
		document.getElementById("overlay").style.display = "block";
	}

	function w3_close() {
		document.getElementById("sidebar").style.display = "none";
		document.getElementById("overlay").style.display = "none";
	}

	function openHelpModal(title="Some help", content='Some Content', footer='footer') {
		document.getElementById("help-modal-title").innerHTML = title;
		document.getElementById("help-modal-content").innerHTML = content;
		document.getElementById("help-modal-footer").innerHTML = footer;
		document.getElementById('help-modal').style.display='block'
	}

	function openDetailsVariantModal(id) {
		$.getJSON("/json/variant/" + id, function(data) {
		    allFeature = '<div class="tableFixHead">';
			allFeature = allFeature + '<table class="w3-table-all w3-card" cellpadding="5" cellspacing="0" border="0">';
			allFeature = allFeature + '<thead class="w3-flat-silver"><tr>'+
		        '<th class="w3-flat-silver control-size-100" >Gene</th>'+
				'<th class="w3-flat-silver control-size-200">Transcript</th>'+
		        '<th class="w3-flat-silver control-size-150" title="Exon-Intron">Ex-In</th>'+
		        '<th class="w3-flat-silver control-size-300" >HGVSc</th>'+
		        '<th class="w3-flat-silver control-size-300" >HGVSp</th>'+
		        '<th class="w3-flat-silver size-250">Consequences</th>'+
				'<th class="showTitle w3-flat-silver control-size-100">MES ref</th>'+
				'<th class="showTitle w3-flat-silver control-size-100">MES diff</th>'+
				'<th class="showTitle w3-flat-silver control-size-100">MES alt</th>'+
			'</tr></thead>';
			allFeature = allFeature + '<tbody>';
			for (x in data["annotations"]["ANN"]) {
				cell = "";
				for (idx in consequences_dict) {
					if (data["annotations"]["ANN"][x]["Consequence"].includes(idx)){
						color = idx in consequences_dict ? consequences_dict[idx]["color"] : "7f8c8d";
						style = "style='max-width:200px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;background-color:#" + color + ";'";
						cell += " <span class='w3-tag' " + style + ">" + idx + "</span>"
					}
				}
				allFeature = allFeature + '<tr>'+
					'<td class="w3-text-black showTitle control-size-100" >'+data["annotations"]["ANN"][x]["SYMBOL"]+'</td>'+
		            '<td class="w3-text-black showTitle control-size-200" >'+data["annotations"]["ANN"][x]["Feature"]+'</td>'+
		            '<td class="w3-text-black showTitle control-size-150" >'+data["annotations"]["ANN"][x]["EI"]+'</td>'+
					'<td class="w3-text-black showTitle control-size-300" >'+data["annotations"]["ANN"][x]["HGVSc"]+'</td>'+
		            '<td class="w3-text-black showTitle control-size-300" >'+data["annotations"]["ANN"][x]["HGVSp"]+'</td>'+
		            '<td class="w3-text-black showTitle size-250">'+cell+'</td>'+
					'<td class="w3-text-black showTitle control-size-100">'+data["annotations"]["ANN"][x]["MaxEntScan_ref"]+'</td>'+
					'<td class="w3-text-black showTitle control-size-100">'+data["annotations"]["ANN"][x]["MaxEntScan_diff"]+'</td>'+
		            '<td class="w3-text-black showTitle control-size-100">'+data["annotations"]["ANN"][x]["MaxEntScan_alt"]+'</td>'+
		        '</tr>';
			}
		    allFeature = allFeature + '</tbody>';
		    allFeature = allFeature + '</table>';
		    allFeature = allFeature + '</div>';
			document.getElementById("allFeaturesTable").innerHTML = allFeature;
		});
		document.getElementById("variant-id").innerHTML = id;
		document.getElementById('modal-details-variant').style.display='block'
	}

	document.getElementsByClassName("tablink")[0].click();

	function openDetails(evt, detailName) {
		var i, x, tablinks;
		x = document.getElementsByClassName("detail");
		for (i = 0; i < x.length; i++) {
			x[i].style.display = "none";
		}
		tablinks = document.getElementsByClassName("tablink");
		for (i = 0; i < x.length; i++) {
			tablinks[i].classList.remove("w3-light-grey");
		}
		document.getElementById(detailName).style.display = "block";
		evt.currentTarget.classList.add("w3-light-grey");
	}

	function changeFilter(id) {
		$.getJSON("http://127.0.0.1:5000/json/filter/" + id, function(data) {
		    $('#variants').DataTable().searchBuilder.rebuild(data);
		});

	}
{% endblock %}
