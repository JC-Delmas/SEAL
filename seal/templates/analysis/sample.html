{% extends 'base.html' %}


{% block content %}
	{% include 'includes/sidebar.j2' %}
	<div class="w3-main" style="margin-left:350px">
		<div class="w3-bar w3-flat-silver w3-left-align w3-padding">
			<h3><i class="fas fa-user-tag"></i> <i>{{ sample.samplename }}</i></h3>
		</div>
		<div class="w3-padding">
			<table cellspacing="5" cellpadding="5" border="0">
		        <tbody><tr>
		            <td>Gnomad Max:</td>
		            <td><input type="text" id="gnomadMax" name="gnomadMax" value="{{ filter.gnomAD_AF }}"></td>
		        </tr>
		    </tbody></table>
			<table id="variants" class="w3-table-all" style="width:100%">
				<thead>
					<tr class="w3-flat-green-sea">
                        <th>chr</th>
                        <th>pos</th>
                        <th>ref</th>
                        <th>alt</th>
                        <th>annotations</th>
					</tr>
				</thead>
				<tfoot>
					<tr class="w3-flat-green-sea">
                        <th>chr</th>
                        <th>pos</th>
                        <th>ref</th>
                        <th>alt</th>
                        <th>annotations</th>
					</tr>
				</tfoot>
			</table>
		</div>

	</div>
{% endblock %}


{% block script %}
	$(document).ready(function() {
	    table = $('#variants').DataTable({
			scrollX: true,
    		ajax: '/json/variants/sample/{{ sample.id }}',
    		"columns": [
		        { "className": 'showTitle control-size-100', "data": "chr"},
		        { "className": 'showTitle control-size-150', "data": "pos"},
		        { "className": 'showTitle control-size-150', "data": "ref"},
				{ "className": 'showTitle control-size-200', "data": "alt"},
		        { "className": 'showTitle control-size-200', "data": "annotations"},
			]
		});

	      // Event listener to the two range filtering inputs to redraw on input
	      $('#gnomadMax').keyup( function() {
	          table.draw();
	      } );

	} );

	// Script to open and close sidebar
	function w3_open() {
		document.getElementById("sidebar").style.display = "block";
		document.getElementById("overlay").style.display = "block";
	}

	function w3_close() {
		document.getElementById("sidebar").style.display = "none";
		document.getElementById("overlay").style.display = "none";
	}

	$.fn.dataTable.ext.search.push(
	    function( settings, data, dataIndex ) {
	        var gnomadMax = parseFloat( $('#gnomadMax').val());
	        var gnomaAD_AF = parseInt( data[1] ) || 0; // use data for the age column

	        if ( isNaN( gnomadMax ) || ( gnomaAD_AF >= gnomadMax ) )
	        {
	            return true;
	        }
	        return false;
	    }
	);

{% endblock %}
